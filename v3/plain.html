<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
</head>
<link href="../GSMod.css" rel="stylesheet" type="text/css">
<link href="../progressbar.css" rel="stylesheet" type="text/css">
<script src="../jquery-2.1.0.min.js"></script>
<script src="../leap-0.6.0.min.js"></script>
<script src="../1euro.js"></script>


<body>
<script src="../move.min.js"></script>
<script src="state-machine.js"></script>
<canvas id="leap-overlay"></canvas>
<canvas id="leap-overlay2" class="overlay"></canvas>
<canvas id="leap-overlay3" class="overlay"></canvas>
<canvas id="touch-overlay"></canvas>
</body>


<script src="../gestures.js"></script>
<script src="../GSMod.js"></script>
<script src="../gl-matrix.js"></script>
<script>
var canvasWidth = 0, canvasHeight = 0;
var ACCELERATION_FACTOR = 3;
var canvas;
var ctxRight;
var ctxLeft;
var ctxTouch;
var CURSOR_SIZE = 30;
var cursorIdleTimeout = false;
function canvasApp() {

    var distanceAlphaProj = 1;


    var isCursorDown = false;
    var clickTimeout = true;
    canvasWidth = document.body.clientWidth;
    canvasHeight = document.body.clientHeight;

    canvas = document.getElementById("leap-overlay");
    // fullscreen
    canvas.width = canvasWidth;
    canvas.height = canvasHeight;
    ctxRight = canvas.getContext("2d");

    canvas = document.getElementById("leap-overlay2");
    // fullscreen
    canvas.width = canvasWidth;
    canvas.height = canvasHeight;
    ctxLeft = canvas.getContext("2d");

    canvas = document.getElementById("leap-overlay3");
    // fullscreen
    canvas.width = canvasWidth;
    canvas.height = canvasHeight;

    canvas = document.getElementById("touch-overlay");
    // fullscreen
    canvas.width = canvasWidth;
    canvas.height = canvasHeight;
    ctxTouch = canvas.getContext("2d");

    leapDeviceMgr.initDevice(canvasWidth, canvasHeight);
    leapDeviceMgr.addDevice("localhost", "right", GESTURE_ALL_RIGHT, rightOnFrame);
    leapDeviceMgr.addDevice("192.168.20.128", "left", GESTURE_ALL_RIGHT, leftOnFrame);
    leapDeviceMgr.start();


    function handleRightAnimation(controls) {
//        console.log("posture: "+controls.posture);
        var ctx = ctxRight;

        var screenX = -controls.x + canvasWidth;
        var screenY = -controls.y + canvasHeight;
        ctx.save();
        ctx.translate(screenX, screenY);
        drawRingnFingers(ctx, controls.fingerList);

        var drawPoint = function (ctx) {
            // pointingfeedback/point/Group/Path
            ctx.save();
            ctx.beginPath();
            ctx.moveTo(89.7, 100.0);
            ctx.lineTo(95.1, 100.0);
            ctx.fill();
            ctx.lineWidth = 3.0;
            ctx.strokeStyle = "rgb(255, 255, 255)";
            ctx.lineCap = "square";
            ctx.stroke();

            // pointingfeedback/point/Group/Path
            ctx.beginPath();
            ctx.moveTo(89.7, 100.0);
            ctx.lineTo(95.1, 100.0);
            ctx.fillStyle = "rgb(255, 255, 255)";
            ctx.fill();
            ctx.lineWidth = 1.0;
            ctx.strokeStyle = "rgb(0, 0, 0)";
            ctx.lineCap = "butt";
            ctx.stroke();

            // pointingfeedback/point/Group
            ctx.restore();

            // pointingfeedback/point/Group/Path
            ctx.save();
            ctx.beginPath();
            ctx.moveTo(104.9, 100.0);
            ctx.lineTo(110.3, 100.0);
            ctx.fill();
            ctx.lineWidth = 3.0;
            ctx.strokeStyle = "rgb(255, 255, 255)";
            ctx.lineCap = "square";
            ctx.stroke();

            // pointingfeedback/point/Group/Path
            ctx.beginPath();
            ctx.moveTo(104.9, 100.0);
            ctx.lineTo(110.3, 100.0);
            ctx.fillStyle = "rgb(255, 255, 255)";
            ctx.fill();
            ctx.lineWidth = 1.0;
            ctx.strokeStyle = "rgb(0, 0, 0)";
            ctx.lineCap = "butt";
            ctx.stroke();

            // pointingfeedback/point/Group
            ctx.restore();

            // pointingfeedback/point/Group/Path
            ctx.save();
            ctx.beginPath();
            ctx.moveTo(100.0, 110.3);
            ctx.lineTo(100.0, 104.9);
            ctx.fill();
            ctx.lineWidth = 3.0;
            ctx.strokeStyle = "rgb(255, 255, 255)";
            ctx.lineCap = "square";
            ctx.stroke();

            // pointingfeedback/point/Group/Path
            ctx.beginPath();
            ctx.moveTo(100.0, 110.3);
            ctx.lineTo(100.0, 104.9);
            ctx.fillStyle = "rgb(255, 255, 255)";
            ctx.fill();
            ctx.lineWidth = 1.0;
            ctx.strokeStyle = "rgb(0, 0, 0)";
            ctx.lineCap = "butt";
            ctx.stroke();

            // pointingfeedback/point/Group
            ctx.restore();

            // pointingfeedback/point/Group/Path
            ctx.save();
            ctx.beginPath();
            ctx.moveTo(100.0, 95.1);
            ctx.lineTo(100.0, 89.7);
            ctx.fill();
            ctx.lineWidth = 3.0;
            ctx.strokeStyle = "rgb(255, 255, 255)";
            ctx.lineCap = "square";
            ctx.stroke();

            // pointingfeedback/point/Group/Path
            ctx.beginPath();
            ctx.moveTo(100.0, 95.1);
            ctx.lineTo(100.0, 89.7);
            ctx.fillStyle = "rgb(255, 255, 255)";
            ctx.fill();
            ctx.lineWidth = 1.0;
            ctx.strokeStyle = "rgb(0, 0, 0)";
            ctx.lineCap = "butt";
            ctx.stroke();

            // pointingfeedback/clickdown
            ctx.restore();
        };

        var drawDown = function (ctx) {
            // pointingfeedback/clickdown/Group/Path
            ctx.save();
            ctx.beginPath();
            ctx.moveTo(92.7, 107.3);
            ctx.lineTo(96.6, 103.4);
            ctx.fill();
            ctx.lineWidth = 3.0;
            ctx.strokeStyle = "rgb(255, 255, 255)";
            ctx.lineCap = "square";
            ctx.stroke();

            // pointingfeedback/clickdown/Group/Path
            ctx.beginPath();
            ctx.moveTo(92.7, 107.3);
            ctx.lineTo(96.6, 103.4);
            ctx.fillStyle = "rgb(255, 255, 255)";
            ctx.fill();
            ctx.lineWidth = 1.0;
            ctx.strokeStyle = "rgb(0, 0, 0)";
            ctx.lineCap = "butt";
            ctx.stroke();

            // pointingfeedback/clickdown/Group
            ctx.restore();

            // pointingfeedback/clickdown/Group/Path
            ctx.save();
            ctx.beginPath();
            ctx.moveTo(103.4, 96.6);
            ctx.lineTo(107.3, 92.7);
            ctx.fill();
            ctx.lineWidth = 3.0;
            ctx.strokeStyle = "rgb(255, 255, 255)";
            ctx.lineCap = "square";
            ctx.stroke();

            // pointingfeedback/clickdown/Group/Path
            ctx.beginPath();
            ctx.moveTo(103.4, 96.6);
            ctx.lineTo(107.3, 92.7);
            ctx.fillStyle = "rgb(255, 255, 255)";
            ctx.fill();
            ctx.lineWidth = 1.0;
            ctx.strokeStyle = "rgb(0, 0, 0)";
            ctx.lineCap = "butt";
            ctx.stroke();

            // pointingfeedback/clickdown/Group
            ctx.restore();

            // pointingfeedback/clickdown/Group/Path
            ctx.save();
            ctx.beginPath();
            ctx.moveTo(107.3, 107.3);
            ctx.lineTo(103.4, 103.4);
            ctx.fill();
            ctx.lineWidth = 3.0;
            ctx.strokeStyle = "rgb(255, 255, 255)";
            ctx.lineCap = "square";
            ctx.stroke();

            // pointingfeedback/clickdown/Group/Path
            ctx.beginPath();
            ctx.moveTo(107.3, 107.3);
            ctx.lineTo(103.4, 103.4);
            ctx.fillStyle = "rgb(255, 255, 255)";
            ctx.fill();
            ctx.lineWidth = 1.0;
            ctx.strokeStyle = "rgb(0, 0, 0)";
            ctx.lineCap = "butt";
            ctx.stroke();

            // pointingfeedback/clickdown/Group
            ctx.restore();

            // pointingfeedback/clickdown/Group/Path
            ctx.save();
            ctx.beginPath();
            ctx.moveTo(96.6, 96.6);
            ctx.lineTo(92.7, 92.7);
            ctx.fill();
            ctx.lineWidth = 3.0;
            ctx.strokeStyle = "rgb(255, 255, 255)";
            ctx.lineCap = "square";
            ctx.stroke();

            // pointingfeedback/clickdown/Group/Path
            ctx.beginPath();
            ctx.moveTo(96.6, 96.6);
            ctx.lineTo(92.7, 92.7);
            ctx.fillStyle = "rgb(255, 255, 255)";
            ctx.fill();
            ctx.lineWidth = 1.0;
            ctx.strokeStyle = "rgb(0, 0, 0)";
            ctx.lineCap = "butt";
            ctx.stroke();

            // pointingfeedback/clutch
            ctx.restore();
        }

        switch (controls.posture) {
            case "+thu+ind":
                var depthScale = controls.depthVal;
                distanceAlphaProj = controls.devianceVal;


                switch (controls.cursorState) {
                    case "active":
                        drawPoint(ctx);
                        break;
                    case "down":
                        if (isCursorDown) {
                            drawPoint(ctx);
                            drawDown(ctx);


                        } else {
                            drawPoint(ctx);
//                                ctx.fillStyle = "rgba(255,255,0,0.4)";
                        }

                        break;
                    case "dragging":
//                            ctx.fillStyle = "rgba(255,0,0,0.9)";
                        break;
                }

                window.clearTimeout(cursorIdleTimeout);
                cursorIdleTimeout = false;
                break;
            case "+ind":
                distanceAlphaProj = controls.devianceVal;

                var depthScale = controls.depthVal;

                var cursorX = controls.x;
                var cursorY = controls.y;
                ctx.fillStyle = "rgba(0,0,0," + distanceAlphaProj + ")";
                ctx.shadowBlur = 20;
                ctx.shadowColor = '#999';
                ctx.beginPath();
                ctx.arc(-cursorX + canvasWidth, -cursorY + canvasHeight, CURSOR_SIZE * depthScale, 0, 2 * Math.PI);
                ctx.fill();

                if (!cursorIdleTimeout) {
                    cursorIdleTimeout = setTimeout(function () {
                        isCursorDown = false;
                    }, 600);
                }

                break;
        }
        ctx.restore();

    }

    function handleRightEvent(controls) {
        switch (controls.cursorEvent) {
            case "clickup":
                if (clickTimeout && isCursorDown) {


                    clickTimeout = false;
                    setTimeout(function () {
                        clickTimeout = true;
                    }, 50);
                    isCursorDown = false;
                }
                controls.cursorEvent = "none";

                break;
            case "clickdown":
                if (clickTimeout) {

                    controls.cursorEvent = "none";
                    isCursorDown = true;
                }
                controls.cursorEvent = "none";
                break;

        }
    }


    function rightOnFrame(controls) {
        ctxRight.clearRect(0, 0, canvas.width, canvas.height);
        ctxRight.fillStyle="#000000";
        ctxRight.fillRect(200,200,800,800);
        if (controls.posture == "invalid") {
            //handleInvalidAnimation(controls);
        } else {
            handleRightAnimation(controls);
            handleRightEvent(controls);
        }
//            console.log("right " + controls.posture);

    }

    function leftOnFrame(controls) {
        ctxLeft.clearRect(0, 0, canvas.width, canvas.height);

        if (controls.posture == "invalid") {
            //handleInvalidAnimation(controls);
        } else {
            //handleAnimation(controls);
            //handleEvent(controls);
        }
//            console.log("left " + controls.posture);

    }
}


$(window).ready(canvasApp());


function drawRingnFingers(ctx, fingersList) {
    ctx.shadowBlur = 0;
    ctx.save();
    ctx.beginPath();

    // handfeedback/ring/Path
    ctx.moveTo(100.0, 132.0);
    ctx.bezierCurveTo(82.3, 132.0, 68.0, 117.7, 68.0, 100.0);
    ctx.bezierCurveTo(68.0, 82.3, 82.3, 68.0, 100.0, 68.0);
    ctx.bezierCurveTo(117.7, 68.0, 132.0, 82.3, 132.0, 100.0);
    ctx.bezierCurveTo(132.0, 117.7, 117.7, 132.0, 100.0, 132.0);
    ctx.closePath();

    // handfeedback/ring/Path
    ctx.moveTo(129.8, 100.0);
    ctx.bezierCurveTo(129.8, 83.6, 116.4, 70.2, 100.0, 70.2);
    ctx.bezierCurveTo(83.6, 70.2, 70.2, 83.6, 70.2, 100.0);
    ctx.bezierCurveTo(70.2, 116.4, 83.6, 129.8, 100.0, 129.8);
    ctx.bezierCurveTo(116.4, 129.8, 129.8, 116.4, 129.8, 100.0);
    ctx.closePath();
    ctx.fillStyle = "rgb(255, 255, 255)";
    ctx.fill();
    ctx.lineWidth = 1.0;
    ctx.stroke();

    if (fingersList[0] > 0) {
        ctx.save();
        ctx.translate(100, 100);
        ctx.rotate(-fingersList[0] * Math.PI / 180);
        ctx.translate(-100, -100);
        ctx.beginPath();
        ctx.moveTo(94.3, 69.5);
        ctx.bezierCurveTo(96.2, 69.2, 98.1, 69.0, 100.0, 69.0);
        ctx.bezierCurveTo(101.9, 69.0, 103.8, 69.2, 105.7, 69.5);
        ctx.bezierCurveTo(105.9, 68.6, 106.0, 67.7, 105.8, 66.7);
        ctx.bezierCurveTo(105.1, 63.6, 101.9, 61.5, 98.7, 62.2);
        ctx.bezierCurveTo(95.6, 62.9, 93.5, 66.1, 94.2, 69.3);
        ctx.bezierCurveTo(94.3, 69.3, 94.3, 69.4, 94.3, 69.5);
        ctx.closePath();
        ctx.fill();

        // handfeedback/fingerout/Path
        ctx.beginPath();
        ctx.moveTo(105.9, 68.5);
        ctx.bezierCurveTo(105.9, 68.0, 105.9, 67.4, 105.8, 66.7);
        ctx.bezierCurveTo(105.1, 63.6, 101.9, 61.5, 98.7, 62.2);
        ctx.bezierCurveTo(95.8, 62.9, 93.9, 65.6, 94.1, 68.5);
        ctx.fill();
        ctx.lineWidth = 1.0;
        ctx.lineCap = "square";
        ctx.stroke();
        ctx.restore();
    } else {
        ctx.save();
        ctx.translate(100, 100);
        ctx.rotate(fingersList[0] * Math.PI / 180);
        ctx.translate(-100, -100);
        ctx.beginPath();
        ctx.moveTo(94.3, 69.3);
        ctx.bezierCurveTo(96.2, 69.1, 98.1, 69.0, 100.0, 69.0);
        ctx.bezierCurveTo(101.9, 69.0, 103.8, 69.1, 105.7, 69.3);
        ctx.bezierCurveTo(105.9, 68.9, 105.9, 68.4, 105.7, 68.0);
        ctx.bezierCurveTo(105.0, 66.4, 101.9, 65.5, 98.8, 65.8);
        ctx.bezierCurveTo(95.6, 66.1, 93.6, 67.6, 94.3, 69.2);
        ctx.bezierCurveTo(94.3, 69.2, 94.3, 69.2, 94.3, 69.3);
        ctx.closePath();
        ctx.fill();

        // handfeedback/fingerin/Path
        ctx.beginPath();
        ctx.moveTo(105.8, 68.5);
        ctx.bezierCurveTo(105.9, 68.3, 105.9, 68.0, 105.7, 67.8);
        ctx.bezierCurveTo(105.0, 66.4, 101.9, 65.5, 98.8, 65.8);
        ctx.bezierCurveTo(95.8, 66.1, 93.9, 67.3, 94.2, 68.5);
        ctx.lineWidth = 0.9;
        ctx.lineCap = "square";
        ctx.stroke();
        ctx.restore();
    }

    for (var i = 1; i < fingersList.length; i++) {
        if (fingersList[i]) {
            ctx.save();
            ctx.translate(100, 100);
            ctx.rotate((i - 2.5) * 30 * Math.PI / 180);
            ctx.translate(-100, -100);
            ctx.beginPath();
            ctx.moveTo(94.3, 69.5);
            ctx.bezierCurveTo(96.2, 69.2, 98.1, 69.0, 100.0, 69.0);
            ctx.bezierCurveTo(101.9, 69.0, 103.8, 69.2, 105.7, 69.5);
            ctx.bezierCurveTo(105.9, 68.6, 106.0, 67.7, 105.8, 66.7);
            ctx.bezierCurveTo(105.1, 63.6, 101.9, 61.5, 98.7, 62.2);
            ctx.bezierCurveTo(95.6, 62.9, 93.5, 66.1, 94.2, 69.3);
            ctx.bezierCurveTo(94.3, 69.3, 94.3, 69.4, 94.3, 69.5);
            ctx.closePath();
            ctx.fill();

            // handfeedback/fingerout/Path
            ctx.beginPath();
            ctx.moveTo(105.9, 68.5);
            ctx.bezierCurveTo(105.9, 68.0, 105.9, 67.4, 105.8, 66.7);
            ctx.bezierCurveTo(105.1, 63.6, 101.9, 61.5, 98.7, 62.2);
            ctx.bezierCurveTo(95.8, 62.9, 93.9, 65.6, 94.1, 68.5);
            ctx.fill();
            ctx.lineWidth = 1.0;
            ctx.lineCap = "square";
            ctx.stroke();
            ctx.restore();
        } else {
            ctx.save();
            ctx.translate(100, 100);
            ctx.rotate((i - 2.5) * 30 * Math.PI / 180);
            ctx.translate(-100, -100);
            ctx.beginPath();
            ctx.moveTo(94.3, 69.3);
            ctx.bezierCurveTo(96.2, 69.1, 98.1, 69.0, 100.0, 69.0);
            ctx.bezierCurveTo(101.9, 69.0, 103.8, 69.1, 105.7, 69.3);
            ctx.bezierCurveTo(105.9, 68.9, 105.9, 68.4, 105.7, 68.0);
            ctx.bezierCurveTo(105.0, 66.4, 101.9, 65.5, 98.8, 65.8);
            ctx.bezierCurveTo(95.6, 66.1, 93.6, 67.6, 94.3, 69.2);
            ctx.bezierCurveTo(94.3, 69.2, 94.3, 69.2, 94.3, 69.3);
            ctx.closePath();
            ctx.fill();

            // handfeedback/fingerin/Path
            ctx.beginPath();
            ctx.moveTo(105.8, 68.5);
            ctx.bezierCurveTo(105.9, 68.3, 105.9, 68.0, 105.7, 67.8);
            ctx.bezierCurveTo(105.0, 66.4, 101.9, 65.5, 98.8, 65.8);
            ctx.bezierCurveTo(95.8, 66.1, 93.9, 67.3, 94.2, 68.5);
            ctx.lineWidth = 0.9;
            ctx.lineCap = "square";
            ctx.stroke();
            ctx.restore();
        }
    }
    ctx.restore();
}

</script>
</html>
